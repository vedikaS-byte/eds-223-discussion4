---
title: "eds-223-discussion4"
format: html
---

# Week 4: Discussion Section: Practice raster manipulations

Import all neccessary data packages: 
```{r}
#| include: False
library(tidyverse)
library(spData)
library(spDataLarge)
library(sf)
library(stars)
library(terra)
```

```{r}
dem <- terra::rast(system.file("raster/dem.tif", package = "spDataLarge"))
landsat <- terra::rast(system.file("raster/landsat.tif", package = "spDataLarge"))
srtm <- terra::rast(system.file("raster/srtm.tif", package = "spDataLarge"))
```

You will be working with the following datasets:

- Digital elevation model (DEM) of Mt. Mongón, Perú, obtained from spDataLarge
- Landsat image of Zion National Park, obtained from spDataLarge
- SRTM elevation of Zion National Park, obtained from spDataLarge

## 2. Explore elevation at Mt. Mongón, Perú
Make a boxplot and histogram of elevation at Mt. Mongón, Perú
```{r}
#| warning: false
#dem
dem %>%st_drop_geometry() %>% boxplot(xlab = "Elevation (m)", col = "lightpink")
dem %>% st_drop_geometry() %>% hist(xlab = "Elevation (m)", col = "lightblue", bins = 40) 
#title("Distribution of Elevation (m) at Mt. Mongón, Perú")
dem
```


Reclassify dem and compute the mean for the three classes:
- Low, where elevation is less than 300
- Medium
- High, where elevation is greater than 500

```{r}
rclass <- matrix(c(
            -Inf, 300, 1, # < 300
            300, 500, 2, # Medium
            500, Inf, 3 # > 500
), ncol = 3, byrow = T)


rclass_elev <- classify(dem, rcl = rclass)
rclass_elev

## Find the mean per class 
# Rename levels in rclass_elev for naming convention 
levels(rclass_elev) <- tibble::tibble(id = 1:3, cats = c("Low", "Medium", "High"))
levels(rclass_elev) # Double check

# Find mean per class using zonal
zonal(dem, rclass_elev, fun = "mean") %>% kableExtra::kable() %>% kableExtra::kable_styling()

```


## 3. Explore NDVI and NDWI at Zion National Park

Landsat 8 bands 2-5 correspond to bands 1-4 for this raster. 
First, correct the scale across all grid cells and then apply the following functions at each grid cell. 

```{r}
# Correct scale across ALL... need global operations
?global
rescale <- function(x) { 
  0.0000275*(x)
  # landsat 1
  
  # landast 2
  # landsat 3 
  # landsat 4
  }

global(landsat, rescale)


```


- Calculate the Normalized Difference Vegetation Index (NDVI) at Zion National Park
- Calculate the Normalized Difference Water Index (NDWI) at Zion National Park
- Find a correlation between NDVI and NDWI at Zion National Park
Hint: Explore the terra package to find a function that can help achieve this!



